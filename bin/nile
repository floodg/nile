#!/usr/bin/env node
var pjson = require('../package.json'),
  main = require('../lib/main'),
  Geocoder = require('../classes/Geocoder').Geocoder,
  program = require('commander'),
  showhelp = true;



var help = function(){
    var examples = [];
    console.log(examples.join("\n"));
}

program
    .version(pjson.version)
    .description('nile n(ode) tileserver')
    .usage('[options]')
    .option('-s, --service', 'run the service')
    .option('-g, --geocode <address>', 'geocode a given adress')
    //.option('-c, --creategeocode', 'create or recreates the geocode index')
    .option('-d, --debug', 'enable debug mode')
    .on('--help', help)
    .parse(process.argv);

if (program.service){
  showhelp = false;

  main.startup();
}

if (program.geocode){
  showhelp = false;
  main.init(function(system){
    system.connect(function(err){
      if (err){
        system.logger.log('error',err);
      }else{
        var geocoder = new Geocoder(system,program.debug);
        geocoder.geoCode(program.geocode,function(err,res){
          console.log(res);
          system.disconnect();
        });
      }
    });
  });
}

/*
if (program.creategeocode){
  showhelp = false;
  main.init(function(system){
    system.connect(function(err){
      if (err){
        system.logger.log('error',err);
      }else{
        var geocoder = new Geocoder(system);
        geocoder.createOrUpdate(function(){
          system.disconnect();
        });
      }
    });
  });
}
*/

if (showhelp){
  program.help();
}
